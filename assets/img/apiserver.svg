<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="3721px" height="3348px" viewBox="-0.5 -0.5 3721 3348" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2022-08-19T07:02:41.460Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/19.0.3 Chrome/102.0.5005.63 Electron/19.0.3 Safari/537.36&quot; etag=&quot;92XjZWOrwBA8FwRvigjH&quot; version=&quot;19.0.3&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;F_VsGBK69sB3bI9-KiYU&quot; name=&quot;第 1 页&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><path d="M 1925 23 L 1925 0 L 2235 0 L 2235 23" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 1925 23 L 1925 110 L 2235 110 L 2235 23" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1925 23 L 2235 23" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="2079.5" y="16">main (cmd/kube-apiserver/apiserver.go)</text></g><rect x="1925" y="20" width="310" height="90" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 65px; margin-left: 1927px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><b>func main()</b> {<div><span style="">	</span><b><font color="#00994d">command := app.NewAPIServerCommand()</font></b></div><div><span style="">	</span><b><font color="#00994d">code := cli.Run(command)</font></b></div><div><span style="">	</span>os.Exit(code)</div><div>}</div></pre></div></div></div></foreignObject><text x="1927" y="69" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">func main() {...</text></switch></g><path d="M 1820 173 L 1820 150 L 2340 150 L 2340 173" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1820 173 L 1820 390 L 2340 390 L 2340 173" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1820 173 L 2340 173" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="2079.5" y="166">Run (cmd/kube-apiserver/app/server.go)</text></g><rect x="1820" y="170" width="520" height="220" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 518px; height: 1px; padding-top: 280px; margin-left: 1822px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><font color="#7f00ff">// Run runs the specified APIServer.This should never exit.</font><div><b>func Run</b>(completeOptions completedServerRunOptions, stopCh &lt;-chan struct{}) error {</div><div><span style="">	</span>...</div><div><span style="">	</span><b><font color="#00994d">server, err := CreateServerChain(completeOptions, stopCh)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return err</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span><b><font color="#00994d">prepared, err := server.PrepareRun()</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return err</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span>return <b><font color="#00994d">prepared.Run(stopCh)</font></b></div><div>}</div></pre></div></div></div></foreignObject><text x="1822" y="284" fill="#000000" font-family="Helvetica" font-size="12px">// Run runs the specified APIServer.This should never exit....</text></switch></g><path d="M 1205 453 L 1205 430 L 2955 430 L 2955 453" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1205 453 L 1205 1160 L 2955 1160 L 2955 453" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1205 453 L 2955 453" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="2079.5" y="446">CreateServerChain (cmd/kube-apiserver/app/server.go)</text></g><rect x="1205" y="450" width="1751" height="710" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1749px; height: 1px; padding-top: 805px; margin-left: 1207px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><font color="#7f00ff">// CreateServerChain creates the apiservers connected via delegation.</font><div><b>func CreateServerChain</b>(completedOptions completedServerRunOptions, stopCh &lt;-chan struct{}) (*aggregatorapiserver.APIAggregator, error) {</div><div><span style="">	</span><font color="#7f00ff">// create apiserver config via run options</font><br /></div><div><span style="">	</span><b><font color="#00994d">kubeAPIServerConfig, serviceResolver, pluginInitializer, err := CreateKubeAPIServerConfig(completedOptions)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span><font color="#7f00ff">// If additional API servers are added, they should be gated.</font></div><div><font color="#7f00ff"><span style="">	</span>// create apiExtensionsServer config<br /></font></div><div><span style="">	</span><b><font color="#00994d">apiExtensionsConfig, err := createAPIExtensionsConfig</font></b>(*kubeAPIServerConfig.GenericConfig, kubeAPIServerConfig.ExtraConfig.VersionedInformers, pluginInitializer, completedOptions.ServerRunOptions, completedOptions.MasterCount,</div><div><span style="">		</span>serviceResolver, webhook.NewDefaultAuthenticationInfoResolverWrapper(kubeAPIServerConfig.ExtraConfig.ProxyTransport, kubeAPIServerConfig.GenericConfig.EgressSelector, kubeAPIServerConfig.GenericConfig.LoopbackClientConfig, kubeAPIServerConfig.GenericConfig.TracerProvider))</div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span><font color="#7f00ff">// notFoundHandler run at the end of delegation chain, returns 503 or 404 (staging/src/k8s.io/apiserver/pkg/util/notfoundhandler/not_found_handler.go)</font><br /></div><div><span style="">	</span><b><font color="#00994d">notFoundHandler := notfoundhandler.New(kubeAPIServerConfig.GenericConfig.Serializer, genericapifilters.NoMuxAndDiscoveryIncompleteKey)</font></b></div><div><span style="">	</span><font color="#7f00ff">// create apiExtensionsServer to extend additional apis which are not part of core k8s apigroup</font><br /></div><div><font color="#7f00ff"><span style="">	</span>// chained with notFoundHandler, apiExtensionsServer.</font><span style="background-color: initial;"><font color="#7f00ff">delegationTarget = notFoundHandler</font></span></div><div><span style="background-color: initial;"><font color="#7f00ff"><span style="">	</span>// handle the requests of </font></span><font color="#7f00ff">CustomResourceDefinition（CRD）</font></div><div><span style="">	</span><b><font color="#00994d">apiExtensionsServer, err := createAPIExtensionsServer(apiExtensionsConfig, genericapiserver.NewEmptyDelegateWithCustomHandler(notFoundHandler))</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><br /></div><div><font color="#7f00ff"><span style="">	</span>// create kubeAPIServer which is used to handle core apis<br /></font></div><div><font color="#7f00ff"><span style="">	</span>// chained with apiExtensionsServer, kubeAPIServer.delegationTarget = apiExtensionsServer</font><br /></div><div><span style="">	</span><b><font color="#00994d">kubeAPIServer, err := CreateKubeAPIServer(kubeAPIServerConfig, apiExtensionsServer.GenericAPIServer)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span><font color="#7f00ff">// aggregator comes last in the chain</font></div><div><span style="">	</span><b><font color="#00994d">aggregatorConfig, err := createAggregatorConfig</font></b>(*kubeAPIServerConfig.GenericConfig, completedOptions.ServerRunOptions, kubeAPIServerConfig.ExtraConfig.VersionedInformers, serviceResolver, kubeAPIServerConfig.ExtraConfig.ProxyTransport, pluginInitializer)</div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><font color="#7f00ff"><span style="">	</span>// create aggregatorServer, chained with kubeAPIServer, aggregatorServer.delegationTarget = kubeAPIServer<br /></font></div><div><font color="#7f00ff"><span style="">	</span>// receive the requests of apiregistration.k8s.io resource and send to aggregated server</font><br /></div><div><span style="">	</span><b><font color="#00994d">aggregatorServer, err := createAggregatorServer(aggregatorConfig, kubeAPIServer.GenericAPIServer, apiExtensionsServer.Informers)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>// we don't need special handling for innerStopCh because the aggregator server doesn't create any go routines</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span>return aggregatorServer, nil</div><div>}</div></pre></div></div></div></foreignObject><text x="1207" y="809" fill="#000000" font-family="Helvetica" font-size="12px">// CreateServerChain creates the apiservers connected via delegation....</text></switch></g><path d="M 155 1243 L 155 1220 L 1425 1220 L 1425 1243" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 155 1243 L 155 2010 L 1425 2010 L 1425 1243" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 155 1243 L 1425 1243" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="789.5" y="1236">CreateKubeAPIServerConfig (cmd/kube-apiserver/app/server.go)</text></g><rect x="155" y="1240" width="1270" height="770" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1268px; height: 1px; padding-top: 1625px; margin-left: 157px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><font color="#7f00ff">// CreateKubeAPIServerConfig creates all the resources for running the API server, but runs none of them</font><div><b>func CreateKubeAPIServerConfig(s completedServerRunOptions)</b> (</div><div><span style="">	</span>*controlplane.Config,</div><div><span style="">	</span>aggregatorapiserver.ServiceResolver,</div><div><span style="">	</span>[]admission.PluginInitializer,</div><div><span style="">	</span>error,</div><div>) {</div><div><span style="">	</span>proxyTransport := CreateProxyTransport()</div><div><span style="white-space: pre;">	</span><font color="#7f00ff">// create generic config</font><br /></div><div><span style="">	</span><b><font color="#00994d">genericConfig, versionedInformers, serviceResolver, pluginInitializers, admissionPostStartHook, storageFactory, err := buildGenericConfig(s.ServerRunOptions, proxyTransport)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, nil, nil, err</div><div><span style="">	</span>}</div><div><span style="white-space: pre;">	</span>...<br /></div><div><span style="white-space: pre;">	</span><font color="#7f00ff">// create master kube-apiserver config (pkg/controlplane/instance.go)</font><br /></div><div><span style="">	</span><b><font color="#00994d">config := &amp;controlplane.Config</font></b>{</div><div><span style="">		</span>GenericConfig: genericConfig,</div><div><span style="">		</span>ExtraConfig: controlplane.ExtraConfig{</div><div><span style="">			</span>APIResourceConfigSource: storageFactory.APIResourceConfigSource,</div><div><span style="">			</span>StorageFactory:                       storageFactory,</div><div><span style="">			</span>EventTTL:                <span style="white-space: pre;">	</span>   s.EventTTL,</div><div><span style="">			</span>KubeletClientConfig:     <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.KubeletConfig,</div><div><span style="">			</span>EnableLogsSupport:       <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.EnableLogsHandler,</div><div><span style="">			</span>ProxyTransport:          <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   proxyTransport,</div><div><br /></div><div><span style="">			</span>ServiceIPRange:          <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.PrimaryServiceClusterIPRange,</div><div><span style="">			</span>APIServerServiceIP:      <span style="white-space: pre;">	</span> <span style="white-space: pre;">	</span>   s.APIServerServiceIP,</div><div><span style="">			</span>SecondaryServiceIPRange: <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.SecondaryServiceClusterIPRange,</div><div><br /></div><div><span style="">			</span>APIServerServicePort: 443,</div><div><br /></div><div><span style="">			</span>ServiceNodePortRange:      <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.ServiceNodePortRange,</div><div><span style="">			</span>KubernetesServiceNodePort: <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.KubernetesServiceNodePort,</div><div><br /></div><div><span style="">			</span>EndpointReconcilerType: <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   reconcilers.Type(s.EndpointReconcilerType),</div><div><span style="">			</span>MasterCount:            <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.MasterCount,</div><div><br /></div><div><span style="">			</span>ServiceAccountIssuer:        <span style="white-space: pre;">	</span>   s.ServiceAccountIssuer,</div><div><span style="">			</span>ServiceAccountMaxExpiration: <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   s.ServiceAccountTokenMaxExpiration,</div><div><span style="">			</span>ExtendExpiration:            <span style="white-space: pre;">	</span>   s.Authentication.ServiceAccounts.ExtendExpiration,</div><div><br /></div><div><span style="">			</span>VersionedInformers: <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>   versionedInformers,</div><div><br /></div><div><span style="">			</span>IdentityLeaseDurationSeconds:      <span style="white-space: pre;">	</span>   s.IdentityLeaseDurationSeconds,</div><div><span style="">			</span>IdentityLeaseRenewIntervalSeconds: <span style="white-space: pre;">	</span>   s.IdentityLeaseRenewIntervalSeconds,</div><div><span style="">		</span>},</div><div><span style="">	</span>}</div><div><span style="white-space: pre;">	</span>...<br /></div><div><br /></div><div><span style="">	</span>return config, serviceResolver, pluginInitializers, nil</div><div>}</div></pre></div></div></div></foreignObject><text x="157" y="1629" fill="#000000" font-family="Helvetica" font-size="12px">// CreateKubeAPIServerConfig creates all the resources for running the API server, but runs none of them...</text></switch></g><path d="M 0 2083 L 0 2060 L 1580 2060 L 1580 2083" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 0 2083 L 0 3340 L 1580 3340 L 1580 2083" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 0 2083 L 1580 2083" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="789.5" y="2076">buildGenericConfig (cmd/kube-apiserver/app/server.go)</text></g><rect x="0" y="2080" width="1580" height="1260" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1578px; height: 1px; padding-top: 2710px; margin-left: 2px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><font color="#7f00ff">// BuildGenericConfig takes the master server options and produces the genericapiserver.Config associated with it</font><div><b>func buildGenericConfig</b>(</div><div><span style="">	</span>s *options.ServerRunOptions,</div><div><span style="">	</span>proxyTransport *http.Transport,</div><div>) (</div><div><span style="">	</span>genericConfig *genericapiserver.Config,</div><div><span style="">	</span>versionedInformers clientgoinformers.SharedInformerFactory,</div><div><span style="">	</span>serviceResolver aggregatorapiserver.ServiceResolver,</div><div><span style="">	</span>pluginInitializers []admission.PluginInitializer,</div><div><span style="">	</span>admissionPostStartHook genericapiserver.PostStartHookFunc,</div><div><span style="">	</span>storageFactory *serverstorage.DefaultStorageFactory,</div><div><span style="">	</span>lastErr error,</div><div>) {</div><div><span style="">	</span><font color="#7f00ff">// create apiserver genericConfig, in NewConfig, the important one is </font><span style="background-color: initial;"><font color="#7f00ff">DefaultBuildHandlerChain which is http filter handler chain (staging/src/k8s.io/apiserver/pkg/server/config.go)</font></span><br /></div><div><span style="">	</span><b><font color="#00994d">genericConfig = genericapiserver.NewConfig(legacyscheme.Codecs)</font></b></div><div><span style="">	</span><b><font color="#00994d">genericConfig.MergedResourceConfig = controlplane.DefaultAPIResourceConfigSource()</font></b></div><div><span style="">	</span>...<br /></div><div><span style="">	</span><font color="#7f00ff">// long connection check</font><br /></div><div><span style="">	</span><b><font color="#00994d">genericConfig.LongRunningFunc = filters.BasicLongRunningRequestCheck</font></b>(</div><div><span style="">		</span>sets.NewString("watch", "proxy"),</div><div><span style="">		</span>sets.NewString("attach", "exec", "proxy", "log", "portforward"),</div><div><span style="">	</span>)</div><div><br /></div><div><span style="">	</span>kubeVersion := version.Get()</div><div><span style="">	</span>genericConfig.Version = &amp;kubeVersion</div><div><span style="">	</span><font color="#7f00ff">// create storageFactory to connect etcd</font><br /></div><div><span style="">	</span>storageFactoryConfig := kubeapiserver.NewStorageFactoryConfig()</div><div><span style="">	</span>storageFactoryConfig.APIResourceConfig = genericConfig.MergedResourceConfig</div><div><span style="">	</span><b><font color="#00994d">completedStorageFactoryConfig, err := storageFactoryConfig.Complete(s.Etcd)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>lastErr = err</div><div><span style="">		</span>return</div><div><span style="">	</span>}</div><div><span style="">	</span>storageFactory, lastErr = completedStorageFactoryConfig.New()</div><div><span style="">	</span>if lastErr != nil {</div><div><span style="">		</span>return</div><div><span style="">	</span>}</div><div><span style="">	</span>...<br /></div><div><font color="#7f00ff"><span style="">	</span>// init authentication config<br /></font></div><div><font color="#7f00ff"><span style="">	</span>// Authentication.ApplyTo requires already applied OpenAPIConfig and EgressSelector if present</font></div><div><span style="">	</span>if lastErr = <b><font color="#00994d">s.Authentication.ApplyTo</font></b>(&amp;genericConfig.Authentication, genericConfig.SecureServing, genericConfig.EgressSelector, genericConfig.OpenAPIConfig, genericConfig.OpenAPIV3Config, clientgoExternalClient, versionedInformers); lastErr != nil {</div><div><span style="">		</span>return</div><div><span style="">	</span>}</div><div><span style="">	</span><font color="#7f00ff">// init authorization config</font><br /></div><div><span style="">	</span><b><font color="#00994d">genericConfig.Authorization.Authorizer, genericConfig.RuleResolver, err = BuildAuthorizer(s, genericConfig.EgressSelector, versionedInformers)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>lastErr = fmt.Errorf("invalid authorization config: %v", err)</div><div><span style="">		</span>return</div><div><span style="">	</span>}</div><div><span style="">	</span>if !sets.NewString(s.Authorization.Modes...).Has(modes.ModeRBAC) {</div><div><span style="">		</span>genericConfig.DisabledPostStartHooks.Insert(rbacrest.PostStartHookName)</div><div><span style="">	</span>}</div><div><span style="">	</span><font color="#7f00ff">// init audit config</font><br /></div><div><span style="">	</span><b><font color="#00994d">lastErr = s.Audit.ApplyTo(genericConfig)</font></b></div><div><span style="">	</span>if lastErr != nil {</div><div><span style="">		</span>return</div><div><span style="">	</span>}</div><div><span style="">	</span><font color="#7f00ff">// init admission config</font><br /></div><div><span style="">	</span>admissionConfig := &amp;kubeapiserveradmission.Config{</div><div><span style="">		</span>ExternalInformers:    versionedInformers,</div><div><span style="">		</span>LoopbackClientConfig: genericConfig.LoopbackClientConfig,</div><div><span style="">		</span>CloudConfigFile:      s.CloudProvider.CloudConfigFile,</div><div><span style="">	</span>}</div><div><span style="">	</span>serviceResolver = buildServiceResolver(s.EnableAggregatorRouting, genericConfig.LoopbackClientConfig.Host, versionedInformers)</div><div><span style="">	</span>pluginInitializers, admissionPostStartHook, err = admissionConfig.New(proxyTransport, genericConfig.EgressSelector, serviceResolver, genericConfig.TracerProvider)</div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>lastErr = fmt.Errorf("failed to create admission plugin initializer: %v", err)</div><div><span style="">		</span>return</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span>err = <b><font color="#00994d">s.Admission.ApplyTo</font></b>(</div><div><span style="">		</span>genericConfig,</div><div><span style="">		</span>versionedInformers,</div><div><span style="">		</span>kubeClientConfig,</div><div><span style="">		</span>utilfeature.DefaultFeatureGate,</div><div><span style="">		</span>pluginInitializers...)</div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>lastErr = fmt.Errorf("failed to initialize admission: %v", err)</div><div><span style="">		</span>return</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span>if utilfeature.DefaultFeatureGate.Enabled(genericfeatures.APIPriorityAndFairness) &amp;&amp; s.GenericServerRunOptions.EnablePriorityAndFairness {</div><div><span style="">		</span>genericConfig.FlowControl, lastErr = BuildPriorityAndFairness(s, clientgoExternalClient, versionedInformers)</div><div><span style="">	</span>}</div><pre><div><span style="">	</span>return</div><div>}</div></pre></pre></div></div></div></foreignObject><text x="2" y="2714" fill="#000000" font-family="Helvetica" font-size="12px">// BuildGenericConfig takes the master server options and produces the genericapiserver.Config associated with it...</text></switch></g><path d="M 2080 110 L 2080 143.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2080 148.88 L 2076.5 141.88 L 2080 143.63 L 2083.5 141.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2080 390 L 2080 423.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2080 428.88 L 2076.5 421.88 L 2080 423.63 L 2083.5 421.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2080.5 1160 L 2080.5 1190 L 790 1190 L 790 1213.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 790 1218.88 L 786.5 1211.88 L 790 1213.63 L 793.5 1211.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 790 2010 L 790 2053.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 790 2058.88 L 786.5 2051.88 L 790 2053.63 L 793.5 2051.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2705 1243 L 2705 1220 L 3655 1220 L 3655 1243" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2705 1243 L 2705 1370 L 3655 1370 L 3655 1243" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2705 1243 L 3655 1243" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="3179.5" y="1236">CreateKubeAPIServer (cmd/kube-apiserver/app/server.go)</text></g><rect x="2705" y="1240" width="950" height="130" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 948px; height: 1px; padding-top: 1305px; margin-left: 2707px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><font color="#7f00ff">// CreateKubeAPIServer creates and wires a workable kube-apiserver</font><div><b>func CreateKubeAPIServer</b>(kubeAPIServerConfig *controlplane.Config, delegateAPIServer genericapiserver.DelegationTarget) (*controlplane.Instance, error) {</div><div><span style="">	</span><b><font color="#00994d">kubeAPIServer, err := kubeAPIServerConfig.Complete().New(delegateAPIServer)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span>return kubeAPIServer, nil</div><div>}</div></pre></div></div></div></foreignObject><text x="2707" y="1309" fill="#000000" font-family="Helvetica" font-size="12px">// CreateKubeAPIServer creates and wires a workable kube-apiserver...</text></switch></g><path d="M 2080.5 1160 L 2080.5 1190 L 3180 1190 L 3180 1213.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 3180 1218.88 L 3176.5 1211.88 L 3180 1213.63 L 3183.5 1211.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2640 1443 L 2640 1420 L 3720 1420 L 3720 1443" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2640 1443 L 2640 2340 L 3720 2340 L 3720 1443" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 2640 1443 L 3720 1443" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="3179.5" y="1436">New (pkg/controlplane/instance.go)</text></g><rect x="2640" y="1440" width="1080" height="900" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1078px; height: 1px; padding-top: 1890px; margin-left: 2642px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><font color="#7f00ff">// New returns a new instance of Master from the given config.</font><div><font color="#7f00ff">// Certain config fields will be set to a default value if unset.</font></div><div><font color="#7f00ff">// Certain config fields must be specified, including:</font></div><div><font color="#7f00ff">// KubeletClientConfig</font></div><div><b>func (c completedConfig) New(delegationTarget genericapiserver.DelegationTarget) (*Instance, error) </b>{</div><div><span style="">	</span>if reflect.DeepEqual(c.ExtraConfig.KubeletClientConfig, kubeletclient.KubeletClientConfig{}) {</div><div><span style="">		</span>return nil, fmt.Errorf("Master.New() called with empty config.KubeletClientConfig")</div><div><span style="">	</span>}</div><div><br /></div><div><span style="">	</span><b><font color="#00994d">s, err := c.GenericConfig.New("kube-apiserver", delegationTarget)</font></b></div><div><span style="">	</span>if err != nil {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><span style="">	</span>...<br /></div><div><span style="">	</span>m := &amp;Instance{</div><div><span style="">		</span>GenericAPIServer:          s,</div><div><span style="">		</span>ClusterAuthenticationInfo:      c.ExtraConfig.ClusterAuthenticationInfo,</div><div><span style="">	</span>}</div><div><br /></div><div><font color="#7f00ff"><span style="">	</span>// every api resource correspond to a RESTStorage which communicate with etcd<br /></font></div><div><font color="#7f00ff"><span style="">	</span>// install /api/... resource handlers</font></div><div><font color="#7f00ff"><span style="">	</span>// </font><span style="background-color: initial;"><font color="#7f00ff">InstallLegacyAPI -&gt; </font></span><span style="background-color: initial;"><font color="#7f00ff">GenericAPIServer.InstallLegacyAPIGroup -&gt; </font></span><span style="background-color: initial;"><font color="#7f00ff">GenericAPIServer.</font></span><span style="background-color: initial;"><font color="#7f00ff">installAPIResources -&gt; </font></span><span style="background-color: initial;"><font color="#7f00ff">apiGroupVersion.InstallREST</font></span></div><div><span style="background-color: initial;"><font color="#7f00ff"><span style="">	</span>// -&gt; </font></span><span style="background-color: initial;"><font color="#7f00ff">APIInstaller.Install (staging/src/k8s.io/apiserver/pkg/endpoints/installer.go) -&gt; </font></span><span style="background-color: initial;"><font color="#7f00ff">APIInstaller.</font></span><span style="background-color: initial;"><font color="#7f00ff">registerResourceHandlers</font></span></div><div><font color="#7f00ff"><span style="">	</span>// call NewLegacyRESTStorage (pkg/registry/core/rest/storage_core.go) to create RESTStorage, module source path is pkg/registry/core/{module_name}/storage/storage.go</font><br /></div><div><span style="">	</span><b><font color="#00994d">if err := m.InstallLegacyAPI(&amp;c, c.GenericConfig.RESTOptionsGetter); err != nil</font></b> {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><br /></div><div><font color="#7f00ff"><span style="">	</span>// all these restStorageProviders will create RESTStorage in the following InstallAPIs<br /></font></div><div><span style="">	</span><b><font color="#00994d">restStorageProviders</font></b> := []RESTStorageProvider{</div><div><span style="">		</span>apiserverinternalrest.StorageProvider{},</div><div><span style="">		</span>authenticationrest.RESTStorageProvider{Authenticator: c.GenericConfig.Authentication.Authenticator, APIAudiences: c.GenericConfig.Authentication.APIAudiences},</div><div><span style="">		</span>authorizationrest.RESTStorageProvider{Authorizer: c.GenericConfig.Authorization.Authorizer, RuleResolver: c.GenericConfig.RuleResolver},</div><div><span style="">		</span>autoscalingrest.RESTStorageProvider{},</div><div><span style="">		</span>batchrest.RESTStorageProvider{},</div><div><span style="">		</span>certificatesrest.RESTStorageProvider{},</div><div><span style="">		</span>coordinationrest.RESTStorageProvider{},</div><div><span style="">		</span>discoveryrest.StorageProvider{},</div><div><span style="">		</span>networkingrest.RESTStorageProvider{},</div><div><span style="">		</span>noderest.RESTStorageProvider{},</div><div><span style="">		</span>policyrest.RESTStorageProvider{},</div><div><span style="">		</span>rbacrest.RESTStorageProvider{Authorizer: c.GenericConfig.Authorization.Authorizer},</div><div><span style="">		</span>schedulingrest.RESTStorageProvider{},</div><div><span style="">		</span>storagerest.RESTStorageProvider{},</div><div><span style="">		</span>flowcontrolrest.RESTStorageProvider{InformerFactory: c.GenericConfig.SharedInformerFactory},</div><div><span style="">		</span>// keep apps after extensions so legacy clients resolve the extensions versions of shared resource names.</div><div><span style="">		</span>// See https://github.com/kubernetes/kubernetes/issues/42392</div><div><span style="">		</span>appsrest.StorageProvider{},</div><div><span style="">		</span>admissionregistrationrest.RESTStorageProvider{},</div><div><span style="">		</span>eventsrest.RESTStorageProvider{TTL: c.ExtraConfig.EventTTL},</div><div><span style="">	</span>}</div><div><br /></div><div><font color="#7f00ff"><span style="">	</span>// install /apis/{group}/... handlers<br /></font></div><div><font color="#7f00ff"><span style="">	</span>// the group names are coming from RESTStorageProvider.GroupName, like eventsrest.RESTStorageProvider (pkg/registry/events/rest/storage_events.go)<br /></font></div><div><font color="#7f00ff"><span style="">	</span>// InstallAPIs iterates all restStorageProviders to construct apiGroupsInfo and call GenericAPIServer.InstallAPIGroups -&gt; GenericAPIServer.installAPIResources</font><br /></div><div><span style="">	</span><b><font color="#00994d">if err := m.InstallAPIs(c.ExtraConfig.APIResourceConfigSource, c.GenericConfig.RESTOptionsGetter, restStorageProviders...); err != nil</font></b> {</div><div><span style="">		</span>return nil, err</div><div><span style="">	</span>}</div><div><span style="white-space: pre;">	</span>...<br /></div><div><br /></div><div><span style="">	</span>return m, nil</div><div>}</div></pre></div></div></div></foreignObject><text x="2642" y="1894" fill="#000000" font-family="Helvetica" font-size="12px">// New returns a new instance of Master from the given config....</text></switch></g><path d="M 3180 1370 L 3180 1413.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 3180 1418.88 L 3176.5 1411.88 L 3180 1413.63 L 3183.5 1411.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1651 2311 L 1651 2288 L 2591 2288 L 2591 2311" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1651 2311 L 1651 3110 L 2591 3110 L 2591 2311" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1651 2311 L 2591 2311" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="2120.5" y="2304">DefaultBuildHandlerChain (staging/src/k8s.io/apiserver/pkg/server/config.go)</text></g><rect x="1651" y="2310" width="940" height="800" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 938px; height: 1px; padding-top: 2710px; margin-left: 1653px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><pre><font color="#7f00ff">// register http filter handlers<br />// WithAuthorization, WithPriorityAndFairness, WithMaxInFlightLimit, WithImpersonation, WithAudit, WithFailedAuthenticationAudit, WithAuthentication<br />// WithCORS, WithTimeoutForNonLongRunningRequests, WithRequestDeadline, WithWaitGroup, WithProbabilistic, WithAuditAnnotations<br />// WithWarningRecorder, WithCacheControl, WithHSTS, WithRetryAfter, WithHTTPLogging, WithTracing, WithLatencyTrackers, WithRequestInfo<br />// WithRequestReceivedTimestamp, WithMuxAndDiscoveryComplete, WithPanicRecovery, WithAuditID</font><br /><b>func DefaultBuildHandlerChain(apiHandler http.Handler, c *Config) http.Handler</b> {<br />	handler = genericapifilters.WithAuthorization(handler, c.Authorization.Authorizer, c.Serializer)<br /><br />	if c.FlowControl != nil {<br />		requestWorkEstimator := flowcontrolrequest.NewWorkEstimator(c.StorageObjectCountTracker.Get, c.FlowControl.GetInterestedWatchCount)		<br />		handler = genericfilters.WithPriorityAndFairness(handler, c.LongRunningFunc, c.FlowControl, requestWorkEstimator)<br />	} else {<br />		handler = genericfilters.WithMaxInFlightLimit(handler, c.MaxRequestsInFlight, c.MaxMutatingRequestsInFlight, c.LongRunningFunc)<br />	}<br />	<br />	handler = genericapifilters.WithImpersonation(handler, c.Authorization.Authorizer, c.Serializer)<br /><br />	handler = genericapifilters.WithAudit(handler, c.AuditBackend, c.AuditPolicyRuleEvaluator, c.LongRunningFunc)<br /><br />	failedHandler := genericapifilters.Unauthorized(c.Serializer)<br />	failedHandler = genericapifilters.WithFailedAuthenticationAudit(failedHandler, c.AuditBackend, c.AuditPolicyRuleEvaluator)<br /><br />	handler = genericapifilters.WithAuthentication(handler, c.Authentication.Authenticator, failedHandler, c.Authentication.APIAudiences)<br /><br />	handler = genericfilters.WithCORS(handler, c.CorsAllowedOriginList, nil, nil, nil, "true")<br /><br />	// WithTimeoutForNonLongRunningRequests will call the rest of the request handling in a go-routine with the<br />	// context with deadline. The go-routine can keep running, while the timeout logic will return a timeout to the client.<br />	handler = genericfilters.WithTimeoutForNonLongRunningRequests(handler, c.LongRunningFunc)<br /><br />	handler = genericapifilters.WithRequestDeadline(handler, c.AuditBackend, c.AuditPolicyRuleEvaluator,<br />		c.LongRunningFunc, c.Serializer, c.RequestTimeout)<br />	handler = genericfilters.WithWaitGroup(handler, c.LongRunningFunc, c.HandlerChainWaitGroup)<br />	if c.SecureServing != nil &amp;&amp; !c.SecureServing.DisableHTTP2 &amp;&amp; c.GoawayChance &gt; 0 {<br />		handler = genericfilters.WithProbabilisticGoaway(handler, c.GoawayChance)<br />	}<br />	handler = genericapifilters.WithAuditAnnotations(handler, c.AuditBackend, c.AuditPolicyRuleEvaluator)<br />	handler = genericapifilters.WithWarningRecorder(handler)<br />	handler = genericapifilters.WithCacheControl(handler)<br />	handler = genericfilters.WithHSTS(handler, c.HSTSDirectives)<br />	if c.ShutdownSendRetryAfter {<br />		handler = genericfilters.WithRetryAfter(handler, c.lifecycleSignals.AfterShutdownDelayDuration.Signaled())<br />	}<br />	handler = genericfilters.WithHTTPLogging(handler)<br />	if utilfeature.DefaultFeatureGate.Enabled(genericfeatures.APIServerTracing) {<br />		handler = genericapifilters.WithTracing(handler, c.TracerProvider)<br />	}<br />	handler = genericapifilters.WithLatencyTrackers(handler)<br />	handler = genericapifilters.WithRequestInfo(handler, c.RequestInfoResolver)<br />	handler = genericapifilters.WithRequestReceivedTimestamp(handler)<br />	handler = genericapifilters.WithMuxAndDiscoveryComplete(handler, c.lifecycleSignals.MuxAndDiscoveryComplete.Signaled())<br />	handler = genericfilters.WithPanicRecovery(handler, c.RequestInfoResolver)<br />	handler = genericapifilters.WithAuditID(handler)<br />	return handler<br />}<br /></pre></div></div></div></foreignObject><text x="1653" y="2714" fill="#000000" font-family="Helvetica" font-size="12px">// register http filter handlers...</text></switch></g><path d="M 1580 2710 L 1644.63 2710" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1649.88 2710 L 1642.88 2713.5 L 1644.63 2710 L 1642.88 2706.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>