var searchBox=document.querySelector(".search"),searchBtn=document.querySelector(".search-start"),searchClear=document.querySelector(".search-clear"),searchInput=document.querySelector(".search-input"),searchResults=document.querySelector(".search-results"),searchValue="",arrItems=[],arrContents=[],arrLinks=[],arrTitles=[],arrResults=[],indexItem=[],itemLength=0,tmpDiv=document.createElement("div");tmpDiv.className="result-item";var xhr=new XMLHttpRequest||new ActiveXObject("Microsoft.XMLHTTP");function searchConfirm(){if(""==searchInput.value)searchResults.style.display="none",searchClear.style.display="none";else if(searchInput.value.search(/^\s+$/)>=0){searchInit();var e=tmpDiv.cloneNode(!0);e.innerText="请输入有效内容...",searchResults.appendChild(e)}else searchInit(),searchValue=searchInput.value,searchMatching(arrTitles,arrContents,searchValue)}function searchInit(){arrResults=[],indexItem=[],searchResults.innerHTML="",searchResults.style.display="block",searchClear.style.display="block"}function searchMatching(e,r,s){for(s=new RegExp(s,"i"),i=0;i<itemLength;i++)if(-1!==e[i].search(s)||-1!==r[i].search(s)){if(-1!==e[i].search(s))var t=e;else t=r;indexItem.push(i);var a=t[i].search(s),n=s.toString().length-3;arrResults.push(t[i].slice(a-10,a)+"<mark>"+t[i].slice(a,a+n)+"</mark>"+t[i].slice(a+n,a+n+10))}var c=tmpDiv.cloneNode(!0);(c.innerHTML="总匹配：<b>"+indexItem.length+"</b> 项",searchResults.appendChild(c),0==indexItem.length)&&((l=tmpDiv.cloneNode(!0)).innerText="未匹配到内容...",searchResults.appendChild(l));for(i=0;i<arrResults.length;i++){var l;(l=tmpDiv.cloneNode(!0)).innerHTML="<b>《"+arrTitles[indexItem[i]]+"》</b><hr />"+arrResults[i],l.setAttribute("onclick","changeHref(arrLinks[indexItem["+i+"]])"),searchResults.appendChild(l)}}function changeHref(e){location.href=e}xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var e=xhr.responseXML;for(arrItems=e.getElementsByTagName("item"),itemLength=arrItems.length,i=0;i<itemLength;i++)arrContents[i]=arrItems[i].getElementsByTagName("description")[0].childNodes[0].nodeValue.replace(/<.*?>/g,""),arrLinks[i]=arrItems[i].getElementsByTagName("link")[0].childNodes[0].nodeValue.replace(/<.*?>/g,""),arrTitles[i]=arrItems[i].getElementsByTagName("title")[0].childNodes[0].nodeValue.replace(/<.*?>/g,"");searchBox.style.display="block"}},xhr.open("get","/feed.xml",!0),xhr.send(),searchBtn.onclick=searchConfirm,searchClear.onclick=function(){searchInput.value="",searchResults.style.display="none",searchClear.style.display="none"},searchInput.oninput=function(){setTimeout(searchConfirm,0)},searchInput.onfocus=function(){searchResults.style.display="block"};